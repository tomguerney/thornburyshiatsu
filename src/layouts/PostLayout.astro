---
import Layout from './Layout.astro';

// Read frontmatter from top-level props or from `frontmatter` object if present (some MD renderers)
const { title, pubDate, description } = Astro.props;
const fm = /** @type {any} */ (Astro.props && Astro.props.frontmatter ? Astro.props.frontmatter : {});
const postTitle = title || fm.title || '';
const postPubDate = pubDate || fm.pubDate || fm.date || '';
const postDescription = description || fm.description || '';

// Format the publication date for display (fallback to raw string if invalid)
let formattedDate = '';
if (postPubDate) {
  try {
    const d = new Date(postPubDate);
    if (!Number.isNaN(d.getTime())) {
      formattedDate = d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
    } else {
      formattedDate = String(postPubDate);
    }
  } catch (e) {
    formattedDate = String(postPubDate);
  }
}
---

<Layout title={postTitle || 'Post'} description={postDescription || ''}>
  <section class="py-16 sm:py-20">
    <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
      <div class="mx-auto max-w-2xl">
        <header class="mb-8">
          {postTitle && <h1 class="text-4xl font-medium tracking-tight text-primary-900 dark:text-primary-100 sm:text-5xl mb-2">{postTitle}</h1>}
          {formattedDate && (
            <time datetime={postPubDate} class="inline-block text-sm text-primary-600 dark:text-primary-400 font-medium uppercase tracking-wider opacity-90 mb-2">{formattedDate}</time>
          )}
        </header>

        <article class="prose prose-lg prose-primary dark:prose-invert max-w-none post-content leading-relaxed">
          <slot />
        </article>
      </div>
    </div>
  </section>
  <style is:global>
    /* Ensure consistent vertical rhythm between markdown block elements inside posts */
    .post-content > * + * {
      margin-top: 1.25rem; /* 20px */
    }
    /* Slightly increase spacing after headings inside posts */
    .post-content h1 + *,
    .post-content h2 + *,
    .post-content h3 + * {
      margin-top: 0.75rem;
    }
  </style>
</Layout>
